var Comments={run:function(e){this.id=e.id,this.newCommentCheckInterval=e.newCommentCheckInterval,this.commentMaxLength=e.commentMaxLength,this.ticket=e.ticket,this.loginFormCheck(),this.textFormCheck(),this.loadComments(0)},commentDellCheck:function(){var e=document.querySelectorAll('input[type="checkbox"]:checked'),t=document.getElementById("commentDellButton");e.length>0?(t.innerHTML="Удалить выделенное ("+e.length+")",t.style.display=""):t.style.display="none"},commentDell:function(){var e=document.getElementById("commentDellButton");e.innerHTML="Удаление...";for(var t=new FormData,n=document.querySelectorAll('input[type="checkbox"]:checked'),o=0;o<n.length;++o){t.append(n[o].name,n[o].value);var m=document.getElementById("comment"+n[o].value);m.parentNode.removeChild(m)}return t.append("ticket",this.ticket),JLoader.request(this.id+"/ajax/dellcomments",{data:t,success:function(t){"Error"!=t?e.innerHTML="Готово":e.innerHTML="Ошибка",setTimeout(function(){Comments.commentDellCheck()},3e3)},error:function(){e.innerHTML="Ошибка"}}),!1},toUser:function(e){window.location="#commentForm";var t=document.getElementById("textForm");t.value+="[b]"+e+"[/b], ",t.focus(),t.setSelectionRange(t.value.length,t.value.length)},clearCommentForm:function(){document.getElementById("loginForm")&&(document.getElementById("loginForm").value=""),document.getElementById("textForm")&&(document.getElementById("textForm").value=""),document.getElementById("captchaForm")&&(document.getElementById("captchaForm").value="",document.getElementById("captcha").src="/modules/captcha/captcha.php?"+Math.random())},loginFormCheck:function(){if(document.getElementById("loginForm")){var e=document.getElementById("loginForm"),t=document.getElementById("loginReport"),n=!1;e.oninput=function(){n&&clearTimeout(n);var o=setTimeout(function(){if(""!=e.value)if(e.value.length<36){var n=new FormData;n.append("login",e.value),JLoader.request(Comments.id+"/ajax/validlogin",{data:n,responseToId:"loginReport"})}else t.innerHTML="Превышен лимит символов";else t.innerHTML=""},2e3);n=o}}},textFormCheck:function(){if(document.getElementById("textForm")){var e=document.getElementById("textForm"),t=document.getElementById("textReport");e.oninput=function(){e.value.length>Comments.commentMaxLength?t.innerHTML="Превышен лимит символов":t.innerHTML=""}}},requestReport:function(e,t,n){if(document.getElementById("requestReport")){var o=document.getElementById("requestReport");o.innerHTML=e,o.style.display="",o.className=t+" animatShow",n&&setTimeout(function(){o.className+=" animatHide"},n)}},requestReportHide:function(){document.getElementById("requestReport").style.display="none"},submitCommentForm:function(){this.requestReport("Отправка...","grey"),document.getElementById("commentDellButton")&&(document.getElementById("commentDellButton").style.display="none");var e=new FormData(document.commentForm);return JLoader.request(this.id+"/ajax/addcomment",{data:e,success:function(e){Comments.clearCommentForm(),isNaN(e)?("Moderation"==e&&Comments.requestReport("Сообщение отправлено на модерацию","green"),"Captcha"==e&&Comments.requestReport("Символы на картинке не совпадают","red"),"Exists"==e&&Comments.requestReport("Логин уже существует","red"),"Error"==e&&Comments.requestReport("Ошибка при добавлении сообщения","red"),"Ticket"==e&&Comments.requestReport("Ошибка при проверке безопасности","red"),"Ban"==e&&Comments.requestReport("Сообщения с вашего ip заблокированы","red")):(Comments.newCommentCheckApply(e),Comments.requestReport("Сообщение успешно добавлено","green")),setTimeout(function(){Comments.loadComments(0)},1e3)},error:function(e){Comments.requestReport("Произошла ошибка при запросе к серверу","red")}}),!1},loadComments:function(e){if(document.getElementById("loadCommentsButton")){var t=document.getElementById("loadCommentsButton");t.parentNode.removeChild(t)}document.getElementById("commentDellButton")&&(document.getElementById("commentDellButton").style.display="none");var n={};0==e?n.responseToId="comments":n.responseToIdAdd="comments",n.error=function(e){Comments.requestReport("Произошла ошибка при запросе к серверу","grey")},n.success=function(e){Comments.newCommentCheck(0)},JLoader.request(this.id+"/ajax/loadcomments/"+e,n)},newCommentCheck:function(e){0!=this.newCommentCheckInterval&&JLoader.request(this.id+"/ajax/newcommentcheck",{success:function(t){if(0!=e){if(e<t){var n=t-e;Comments.requestReport("Есть новые сообщения ("+n+') <a href="javascript:void(0);"  onClick="Comments.newCommentShow();">Показать</a>',"grey")}e>t&&Comments.newCommentCheckApply(t)}else Comments.newCommentCheckApply(t)}})},newCommentCheckApply:function(e){0!=this.newCommentCheckInterval&&(this.newCommentCheckIntervalId&&clearInterval(this.newCommentCheckIntervalId),this.newCommentCheckIntervalId=setInterval(function(){Comments.newCommentCheck(e)},this.newCommentCheckInterval))},newCommentShow:function(){this.requestReportHide(),this.loadComments(0)}};