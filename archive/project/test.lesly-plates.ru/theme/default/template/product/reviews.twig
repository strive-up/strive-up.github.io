{{ header }}
<div id="product-reviews" class="container">
    <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
            <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
    </ul>
    <div class="row">
        {{ column_left }}
        {% if column_left and column_right %}
            {% set class = 'col-sm-6' %}
        {% elseif column_left or column_right %}
            {% set class = 'col-sm-9' %}
        {% else %}
            {% set class = 'col-sm-12' %}
        {% endif %}
        <div id="content" class="{{ class }}">
{#            {{ content_top }}#}
            <h1>
                Отзывы о магазине
{#                {{ heading_title }}#}
            </h1>
            <p>Оставьте ваш отзыв о работе нашего магазина, поделитесь своими впечатлениями и о том, понравилась ли вам наша продукция.
                Спасибо за ваше внимание к нам!
            </p>

            {% if reviews %}
                <div class="review-list">
                    {% for review in reviews %}

                        <div class="review-list__item uni-item row">
                            <div class="col-xs-12 col-sm-2 col-xxl-3">
                                <div class="review-list__rating rating">
                                    {% for i in 1..5 %}
                                        <i class="{{ review.rating < i ? 'far' : 'fa' }} fa-star"></i>
                                    {% endfor %}
                                </div>
                                <div class="review-list__name"><i class="review-list__icon fa fa-user"></i>{{ review.author }}</div>
                                <div class="review-list__date"><i class="review-list__icon fa fa-calendar"></i>{{ review.date_added }}</div>
                            </div>
                            <div class="col-xs-12 col-sm-10 col-xxl-17">
{#                                {% if review.plus %}#}
{#                                    <div class="review-list__plus">#}
{#                                        <div class="review-list__plus-heading"><i class="review-list__icon fa fa-plus"></i>{{ text_review_plus }}</div>#}
{#                                        {{ review.plus }}#}
{#                                    </div>#}
{#                                {% endif %}#}
{#                                {% if review.minus %}#}
{#                                    <div class="review-list__minus">#}
{#                                        <div class="review-list__minus-heading"><i class="review-list__icon fa fa-minus"></i>{{ text_review_minus }}</div>#}
{#                                        {{ review.minus }}#}
{#                                    </div>#}
{#                                {% endif %}#}
                                <div class="review-list__comment">
{#                                    {% if review.plus or review.minus %}#}
{#                                        <div class="review-list__comment-heading"><i class="review-list__icon fa fa-comment"></i>{{ text_review_comment }}</div>#}
{#                                    {% endif %}#}
                                    {{ review.text }}
                                </div>
                                {% if review.admin_reply %}
                                    <div class="review-list__reply">
                                        <div class="review-list__reply-heading"><i class="review-list__reply-icon fa fa-reply"></i>{{ text_admin_reply }}</div>
                                        {{ review.admin_reply }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <div class="text-right">{{ pagination }}</div>
            {% else %}
                <p>
                    Нет отзывов
                </p>
            {% endif %}

            <button style="height: 70px; width: 180px" type="button" onclick="$('.review-form-wrapper').collapse('toggle');" class="product-thumb__add-to-cart add_to_cart btn " title="В корзину" data-pid="64">
                <span class="hidden-sm hidden-md" style="font-size: 20px;">Добавить отзыв</span>
            </button>

{#            <button class="btn btn-sm btn-primary" onclick="$('.review-form-wrapper').collapse('toggle');">#}
{#                Добавить отзыв#}
{#            </button>#}
            <div class="review-form-wrapper collapse">
                <form class="review-form form-horizontal uni-form" id="form-review">
                    {% if review_guest %}
                        <div class="form-group required">
                            <label class="col-sm-2 control-label" for="input-name">
                                Имя
                            </label>
                            <div class="col-sm-10">
                                <input type="text" name="name" value="{{ customer_name }}" id="input-name" class="form-control" />
                            </div>
                        </div>
                        {% if show_plus_minus_review %}
                            <div class="form-group {{ plus_minus_review_required ? 'required' }}">
                                <label class="col-sm-2 control-label" for="input-review-plus">
                                    {{ entry_plus }}
                                </label>
                                <div class="col-sm-10">
                                    <textarea name="plus" rows="5" id="input-review-plus" class="form-control"></textarea>
                                </div>
                            </div>
                            <div class="form-group {{ plus_minus_review_required ? 'required' }}">
                                <label class="col-sm-2 control-label" for="input-review-minus">{{ entry_minus }}</label>
                                <div class="col-sm-10">
                                    <textarea name="minus" rows="5" id="input-review-minus" class="form-control"></textarea>
                                </div>
                            </div>
                        {% else %}
                            <input type="hidden" name="plus" value="" />
                            <input type="hidden" name="minus" value="" />
                        {% endif %}
                        <div class="form-group required">
                            <label class="col-sm-2 control-label" for="input-review">
                                Текст
                            </label>
                            <div class="col-sm-10">
                                <textarea name="text" rows="5" id="input-review" class="form-control"></textarea>
                                <div class="help-block"><small>{{ text_note }}</small></div>
                            </div>
                        </div>
                        <div class="form-group required">
                            <label class="col-sm-2 control-label">Рейтинг</label>
                            <div class="col-sm-10">
                                <input type="radio" name="rating" value="1" class="review-form__input" />
                                <input type="radio" name="rating" value="2" class="review-form__input" />
                                <input type="radio" name="rating" value="3" class="review-form__input" />
                                <input type="radio" name="rating" value="4" class="review-form__input" />
                                <input type="radio" name="rating" value="5" class="review-form__input" />

                                <div class="review-form__stars rating">
                                    <i class="review-form__star far fa-star"></i>
                                    <i class="review-form__star far fa-star"></i>
                                    <i class="review-form__star far fa-star"></i>
                                    <i class="review-form__star far fa-star"></i>
                                    <i class="review-form__star far fa-star"></i>
                                </div>
                            </div>
                        </div>
                        {{ captcha }}
                        <div class="form-group">
                            <div class="col-sm-2 hidden-xs"></div>
                            <div class="col-sm-10">
                                <button type="button" id="button-review" data-loading-text="{{ text_loading }}" class="review-form__btn btn btn-lg btn-primary">{{ add_new_review }}</button>
                            </div>
                        </div>
                    {% else %}
                        {{ text_login }}
                    {% endif %}
                </form>
            </div>

            {{ content_bottom }}
        </div>
        {{ column_right }}
    </div>
</div>
{{ footer }}

<script>
    $(function () {
        $('#button-review').on('click', function() {
            $.ajax({
                url: 'index.php?route=product/reviews/write',
                type: 'post',
                dataType: 'json',
                data: $('#form-review').serialize(),
                beforeSend: function() {
                    $('#button-review').button('loading');
                },
                complete: function() {
                    $('#button-review').button('reset');
                },
                success: function(json) {

                    location.href = 'https://lesly-plates.ru/index.php?route=product/reviews&done=1';

                    // if (json['error']) {
                    //     uniFlyAlert('danger', json['error']);
                    // }
                    //
                    // if (json['success']) {
                    //     $('#form-review').before('<div class="alert alert-success"><i class="fa fa-check-circle"></i> '+json['success']+' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
                    //     $('#form-review input, #form-review textarea').val('');
                    //     $('.review_star input').attr('checked', false).prop('checked', false);
                    //     $('#form-review').slideToggle();
                    //
                    //     scroll_to('.alert.alert-success');
                    // }
                }
            });
        });

        $('.review-form__input').on('mouseenter', function () {
            $('.review-form__star:lt('+$(this).val()+')').removeClass('far').addClass('fa');

            $(this).on('mouseleave', function() {
                $('.review-form__star').removeClass('fa').addClass('far');

                $('.review-form__input').each(function() {
                    if($(this).prop('checked')) {
                        $('.review-form__star:lt('+$(this).val()+')').removeClass('far').addClass('fa');
                    }
                });
            });
        });

        $('.review-form__input').on('click', function(){
            $('.review-form__star:not(:lt('+$(this).val()+'))').removeClass('fa').addClass('far');
        });
    });
</script>
